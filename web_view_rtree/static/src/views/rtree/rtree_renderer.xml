<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">

    <t
        t-name="web_view_rtree.RTreeRenderer.Rows"
        t-inherit="web.ListRenderer.Rows"
        t-inherit-mode="primary"
        owl="1"
    >
        <!--
            as only the record row template is used and it can have children,
            move the part displaying the contents after each record row
            (instead of using it for groups)
        -->
        <xpath
            expr="t/t/t[@t-call='{{ constructor.recordRowTemplate }}']"
            position="after"
        >
            <t t-set="group" t-value="record" />
            <xpath expr="//t[@t-if='!group.isFolded']" position="move" />
        </xpath>

        <!-- remove the (now almost empty) top else branch -->
        <xpath expr="t[@t-else]" position="replace" />

        <!-- replace the top element by its contents -->
        <xpath expr="t[@t-if='!list.isGrouped']" position="replace">
            <xpath expr="t/t[@t-foreach='list.records']" position="move" />
            <xpath expr="t/tr[@t-if='displayRowCreates']" position="move" />
            <!--
                the part that displays the empty rows is intentionally omitted
            -->
        </xpath>
    </t>

    <t
        t-name="web_view_rtree.RTreeRenderer.RecordRow"
        t-inherit="web.ListRenderer.RecordRow"
        t-inherit-mode="primary"
        owl="1"
    >
        <!--
            decorate record with children as a group (needed for children to
            be padded to the right)
        -->
        <xpath expr="tr[@class='o_data_row']" position="attributes">
            <attribute
                name="t-attf-class"
            >{{record.count > 0 ? 'o_group_has_content' : ''}} o_group_header {{!record.isFolded ? 'o_group_open' : ''}}</attribute>
        </xpath>

        <!--
            add a caret (or a space for it) before the contents of the first
            column.
        -->
        <xpath
            expr="tr/t/t/td/t/t[@t-if='canUseFormatter(column, record)']"
            position="before"
        >
            <t t-if="isFirstNonWidgetColumn(column)">
                <t t-if="record.hasChildren">
                    <span
                        t-attf-class="o_group_caret fa fa-fw {{record.isFolded ? 'fa-caret-right' : 'fa-caret-down' }} me-1"
                        t-attf-style="--o-list-group-level: {{getGroupLevel(record)}}"
                        t-on-click.stop="() => this.toggleGroup(record)"
                    />
                </t>
                <t t-else="">
                    <span
                        t-attf-class="o_group_caret fa fa-fw me-1"
                        t-attf-style="--o-list-group-level: {{getGroupLevel(record)}}"
                    />
                </t>
            </t>
        </xpath>

        <!--
            add the number of children after the contents of the first column.
        -->
        <xpath expr="tr/t/t/td/t/Field" position="after">
            <t t-if="isFirstNonWidgetColumn(column) and record.hasChildren">
                <span class="text-muted ms-2">(<t t-esc="record.count" />)</span>
            </t>
        </xpath>

        <!--
            display an empty cell for placeholder fields
        -->
        <xpath
            expr="tr/t/t[@t-if=&quot;column.type === 'widget'&quot;]"
            position="after"
        >
            <t t-if="column.type === 'placeholder'">
                <td
                    t-on-keydown.synthetic="(ev) => this.onCellKeydown(ev, record, record)"
                    class="o_data_cell cursor-pointer"
                    t-on-click="(ev) => this.onCellClicked(record, column, ev)"
                    tabindex="-1"
                />
            </t>
        </xpath>
    </t>

</templates>
